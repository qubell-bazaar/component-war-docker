application:
  interfaces:
    configuration:
      "*": bind(builder#configuration.*)
    artifact:
      artifact-url: bind(checker#connection.url)
  configuration:
    configuration.war-path: "application.war"
    configuration.docker-image-id: "qubell/artifact-builder:latest"
  bindings:
    - [builder, checker]
  components:
    builder:
      type: docker.Container
      interfaces:
        configuration:
          git-url:
            type: configuration(string)
            name: "Git Repo URL"
          git-branch:
            type: configuration(string)
            name: "Branch"
          war-path:
            type: configuration(string)
            name: "Result WAR File Name"
          docker-image-id:
            type: configuration(string)
            name: "Docker Image ID"
        war:
          url:
            type: publish-signal(string)
            name: "WAR Url"
        docker-container:
          docker-image-id:
            type: publish-signal(string)
            name: "Docker Image ID"
          docker-container-name: 
            type: publish-signal(string)
            name: "Docker Container Name"
      configuration:
        docker.image: "{$.configuration.docker-image-id}"
        docker.environment:
          GIT_URL: "{$.configuration.git-url}"
          GIT_BRANCH: "{$.configuration.git-branch}"
          PUBLISH_PATH: "{$.configuration.war-path}"
          ARTIFACT_PATTERN: "*.war"
        docker.signals:           
          war.url: "http://{$.docker.ports.80.host}:{$.docker.ports.80.port}/{$.configuration.war-path}?{$.configuration.git-branch}"
          docker-container.docker-image-id: "{$.configuration.docker-image-id}"
          docker-container.docker-container-name: "{$.docker.name}"
        docker.expose:
          "80": "*"
    checker:
      type: cobalt.common.HttpEndpoint
      configuration:
        configuration.method: HEAD
